{% extends 'header.html' %}
{% import "macros.html" as macros %}
{% import "activities/activities_macros.html" as activities_macros %}

{% block head %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<script src="{{ url_for('static', filename='js/common_ajax.js') }}"></script>
<script src="{{ url_for('static', filename='js/activities_ajax.js') }}"></script>
{% endblock %}

{% block title %}Activity {{ question.id }} - Settings{% endblock %}

{% block content %}
<div class="modal fade" id="update-choice-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel"></h4>
      </div>
        <div class="modal-body">
          <form id="update-choice-form" method="post">
            {{ macros.render_field(update_choice_form.label) }}
            {{ macros.render_field(update_choice_form.choice) }}
            {{ macros.render_field(update_choice_form.correct) }}
            {{ macros.render_field(update_choice_form.submit, value="Save") }}
          </form>
          <form id="delete-choice-form" method="delete">
            {{ macros.render_field(delete_choice_form.submit,
            class_="btn-danger") }}
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>
  </div>
</div>

<h3>General</h3>

<form action="{{ url_for('activities.update_activity', activity_id=question.id
) }}" method="post" id="update-activity-form">
  {{ macros.render_field(general_form.question) }}
  {{ macros.render_field(general_form.num_graphs) }}
  {{ macros.render_field(general_form.explanation) }}
  {{ macros.render_field(general_form.needs_reflection) }}
  {{ macros.render_field(general_form.submit) }}
</form>

<hr>

<h3>Datasets associated with this activity</h3>
<div class="alert alert-info" role="alert">
  If this activity is not associated with any datasets, it may use a graph
  from any dataset.
</div>

<form action="{{ url_for('activities.update_question_datasets',
activity_id=question.id) }}" method="patch" id="remove-dataset-form">
  <div class="table-container">
    {{ activities_macros.dataset_table(dataset_form, remove_dataset_mapping) }}
  </div>
  {{ macros.render_field(dataset_form.submit, value="Dissasociate datasets",
  class_="btn-danger") }}
</form>

<hr>

<h3>Datasets not associated with this activity</h3>
<form action="{{ url_for('activities.update_question_datasets',
activity_id=question.id) }}" method="patch" id="add-dataset-form">
  <div class="table-container">
    {{ activities_macros.dataset_table(dataset_form, add_dataset_mapping) }}
  </div>
  {{ macros.render_field(dataset_form.submit, value="Associate datasets") }}
</form>

<hr>

<h3>Regenerate assignments</h3>
<p>If you have modified the associated datasets of this question, you must
regenerate assignments before the changes will take effect.</p>
<p>This will destroy all records of student progress with this question.</p>

button goes here...

<hr>

<h3>Choices</h3>
<form action="{{ url_for('activities.create_choice', question_id=question.id
) }}" method="put" id="create-choice-form">
  <div class="table-container">
    {{ activities_macros.choice_table(choices, create_choice_form) }}
  </div>
</form>

<hr>

<h3>Delete activity</h3>
<div class="alert alert-danger" role="alert">
  {{ macros.render_glyphicon("exclamation-sign") }}
  Warning: this cannot be undone!
</div>
<form action="{{ url_for('activities.delete_activity', activity_id=question.id
) }}" method="delete" id="delete-activity-form">
  {{ macros.render_field(delete_activity_form.submit, class_="btn-danger") }}
</form>
{% endblock %}
